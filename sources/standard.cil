;;;;;;;;;;;;;;;;;;;;;;;;;;
;
; Constraints
;

(constrain (process (transition dyntransition noatsecure siginh rlimitinh))
	(or (or (or (eq u1 u2)
	(and (eq t1 standard.id_change_exemption_subj_type_attribute) (eq t2
		standard.user_exemption_target_subj_type_attribute)))
	(and (eq t1 standard.sys_id_change_exemption_subj_type_attribute) (eq
		u2 sys.id)))
	(eq t1 standard.uncond_exemption_subj_type_attribute)))

(constrain (process (transition dyntransition noatsecure siginh rlimitinh))
	(or (or (or (eq r1 r2)
	(and (eq t1 standard.role_change_exemption_subj_type_attribute)
		(eq t2 standard.user_exemption_target_subj_type_attribute)))
	(and (eq t1 standard.sys_role_change_exemption_subj_type_attribute)
		(eq r2 sys.role)))
	(eq t1 standard.uncond_exemption_subj_type_attribute)))

(constrain (file (create relabelto relabelfrom))
	(or (or (eq u1 u2)
	(and (eq t1 standard.obj_sys_id_change_exemption_subj_type_attribute)
		(eq u2 sys.id)))
	(eq t1 standard.obj_id_change_exemption_subj_type_attribute)))

(constrain (dir (create relabelto relabelfrom))
	(or (or (eq u1 u2)
	(and (eq t1 standard.obj_sys_id_change_exemption_subj_type_attribute)
		(eq u2 sys.id)))
	(eq t1 standard.obj_id_change_exemption_subj_type_attribute)))

(constrain (lnk_file (create relabelto relabelfrom))
	(or (or (eq u1 u2)
	(and (eq t1 standard.obj_sys_id_change_exemption_subj_type_attribute)
		(eq u2 sys.id)))
	(eq t1 standard.obj_id_change_exemption_subj_type_attribute)))

(constrain (chr_file (create relabelto relabelfrom))
	(or (or (eq u1 u2)
	(and (eq t1 standard.obj_sys_id_change_exemption_subj_type_attribute)
		(eq u2 sys.id)))
	(eq t1 standard.obj_id_change_exemption_subj_type_attribute)))

(constrain (blk_file (create relabelto relabelfrom))
	(or (or (eq u1 u2)
	(and (eq t1 standard.obj_sys_id_change_exemption_subj_type_attribute)
		(eq u2 sys.id)))
	(eq t1 standard.obj_id_change_exemption_subj_type_attribute)))

(constrain (sock_file (create relabelto relabelfrom))
	(or (or (eq u1 u2)
	(and (eq t1 standard.obj_sys_id_change_exemption_subj_type_attribute)
		(eq u2 sys.id)))
	(eq t1 standard.obj_id_change_exemption_subj_type_attribute)))

(constrain (fifo_file (create relabelto relabelfrom))
	(or (or (eq u1 u2)
	(and (eq t1 standard.obj_sys_id_change_exemption_subj_type_attribute)
		(eq u2 sys.id)))
	(eq t1 standard.obj_id_change_exemption_subj_type_attribute)))

(constrain (tcp_socket (create relabelto relabelfrom))
	(or (or (eq u1 u2)
	(and (eq t1 standard.obj_sys_id_change_exemption_subj_type_attribute)
		(eq u2 sys.id)))
	(eq t1 standard.obj_id_change_exemption_subj_type_attribute)))

(constrain (udp_socket (create relabelto relabelfrom))
	(or (or (eq u1 u2)
	(and (eq t1 standard.obj_sys_id_change_exemption_subj_type_attribute)
		(eq u2 sys.id)))
	(eq t1 standard.obj_id_change_exemption_subj_type_attribute)))

(constrain (rawip_socket (create relabelto relabelfrom))
	(or (or (eq u1 u2)
	(and (eq t1 standard.obj_sys_id_change_exemption_subj_type_attribute)
		(eq u2 sys.id)))
	(eq t1 standard.obj_id_change_exemption_subj_type_attribute)))

(constrain (packet_socket (create relabelto relabelfrom))
	(or (or (eq u1 u2)
	(and (eq t1 standard.obj_sys_id_change_exemption_subj_type_attribute)
		(eq u2 sys.id)))
	(eq t1 standard.obj_id_change_exemption_subj_type_attribute)))

(constrain (unix_stream_socket (create relabelto relabelfrom))
	(or (or (eq u1 u2)
	(and (eq t1 standard.obj_sys_id_change_exemption_subj_type_attribute)
		(eq u2 sys.id)))
	(eq t1 standard.obj_id_change_exemption_subj_type_attribute)))

(constrain (unix_dgram_socket (create relabelto relabelfrom))
	(or (or (eq u1 u2)
	(and (eq t1 standard.obj_sys_id_change_exemption_subj_type_attribute)
		(eq u2 sys.id)))
	(eq t1 standard.obj_id_change_exemption_subj_type_attribute)))

(constrain (netlink_route_socket (create relabelto relabelfrom))
	(or (or (eq u1 u2)
	(and (eq t1 standard.obj_sys_id_change_exemption_subj_type_attribute)
		(eq u2 sys.id)))
	(eq t1 standard.obj_id_change_exemption_subj_type_attribute)))

(constrain (netlink_tcpdiag_socket (create relabelto relabelfrom))
	(or (or (eq u1 u2)
	(and (eq t1 standard.obj_sys_id_change_exemption_subj_type_attribute)
		(eq u2 sys.id)))
	(eq t1 standard.obj_id_change_exemption_subj_type_attribute)))

(constrain (netlink_nflog_socket (create relabelto relabelfrom))
	(or (or (eq u1 u2)
	(and (eq t1 standard.obj_sys_id_change_exemption_subj_type_attribute)
		(eq u2 sys.id)))
	(eq t1 standard.obj_id_change_exemption_subj_type_attribute)))

(constrain (netlink_xfrm_socket (create relabelto relabelfrom))
	(or (or (eq u1 u2)
	(and (eq t1 standard.obj_sys_id_change_exemption_subj_type_attribute)
		(eq u2 sys.id)))
	(eq t1 standard.obj_id_change_exemption_subj_type_attribute)))

(constrain (netlink_selinux_socket (create relabelto relabelfrom))
	(or (or (eq u1 u2)
	(and (eq t1 standard.obj_sys_id_change_exemption_subj_type_attribute)
		(eq u2 sys.id)))
	(eq t1 standard.obj_id_change_exemption_subj_type_attribute)))

(constrain (netlink_audit_socket (create relabelto relabelfrom))
	(or (or (eq u1 u2)
	(and (eq t1 standard.obj_sys_id_change_exemption_subj_type_attribute)
		(eq u2 sys.id)))
	(eq t1 standard.obj_id_change_exemption_subj_type_attribute)))

(constrain (netlink_dnrt_socket (create relabelto relabelfrom))
	(or (or (eq u1 u2)
	(and (eq t1 standard.obj_sys_id_change_exemption_subj_type_attribute)
		(eq u2 sys.id)))
	(eq t1 standard.obj_id_change_exemption_subj_type_attribute)))

(constrain (netlink_kobject_uevent_socket (create relabelto relabelfrom))
	(or (or (eq u1 u2)
	(and (eq t1 standard.obj_sys_id_change_exemption_subj_type_attribute)
		(eq u2 sys.id)))
	(eq t1 standard.obj_id_change_exemption_subj_type_attribute)))

(constrain (appletalk_socket (create relabelto relabelfrom))
	(or (or (eq u1 u2)
	(and (eq t1 standard.obj_sys_id_change_exemption_subj_type_attribute)
		(eq u2 sys.id)))
	(eq t1 standard.obj_id_change_exemption_subj_type_attribute)))

(constrain (dccp_socket (create relabelto relabelfrom))
	(or (or (eq u1 u2)
	(and (eq t1 standard.obj_sys_id_change_exemption_subj_type_attribute)
		(eq u2 sys.id)))
	(eq t1 standard.obj_id_change_exemption_subj_type_attribute)))

(constrain (tun_socket (create relabelto relabelfrom))
	(or (or (eq u1 u2)
	(and (eq t1 standard.obj_sys_id_change_exemption_subj_type_attribute)
		(eq u2 sys.id)))
	(eq t1 standard.obj_id_change_exemption_subj_type_attribute)))

(constrain (netlink_iscsi_socket (create relabelto relabelfrom))
	(or (or (eq u1 u2)
	(and (eq t1 standard.obj_sys_id_change_exemption_subj_type_attribute)
		(eq u2 sys.id)))
	(eq t1 standard.obj_id_change_exemption_subj_type_attribute)))

(constrain (netlink_fib_lookup_socket (create relabelto relabelfrom))
	(or (or (eq u1 u2)
	(and (eq t1 standard.obj_sys_id_change_exemption_subj_type_attribute)
		(eq u2 sys.id)))
	(eq t1 standard.obj_id_change_exemption_subj_type_attribute)))

(constrain (netlink_connector_socket (create relabelto relabelfrom))
	(or (or (eq u1 u2)
	(and (eq t1 standard.obj_sys_id_change_exemption_subj_type_attribute)
		(eq u2 sys.id)))
	(eq t1 standard.obj_id_change_exemption_subj_type_attribute)))

(constrain (netlink_netfilter_socket (create relabelto relabelfrom))
	(or (or (eq u1 u2)
	(and (eq t1 standard.obj_sys_id_change_exemption_subj_type_attribute)
		(eq u2 sys.id)))
	(eq t1 standard.obj_id_change_exemption_subj_type_attribute)))

(constrain (netlink_generic_socket (create relabelto relabelfrom))
	(or (or (eq u1 u2)
	(and (eq t1 standard.obj_sys_id_change_exemption_subj_type_attribute)
		(eq u2 sys.id)))
	(eq t1 standard.obj_id_change_exemption_subj_type_attribute)))

(constrain (netlink_scsitransport_socket (create relabelto relabelfrom))
	(or (or (eq u1 u2)
	(and (eq t1 standard.obj_sys_id_change_exemption_subj_type_attribute)
		(eq u2 sys.id)))
	(eq t1 standard.obj_id_change_exemption_subj_type_attribute)))

(constrain (netlink_rdma_socket (create relabelto relabelfrom))
	(or (or (eq u1 u2)
	(and (eq t1 standard.obj_sys_id_change_exemption_subj_type_attribute)
		(eq u2 sys.id)))
	(eq t1 standard.obj_id_change_exemption_subj_type_attribute)))

(constrain (netlink_crypto_socket (create relabelto relabelfrom))
	(or (or (eq u1 u2)
	(and (eq t1 standard.obj_sys_id_change_exemption_subj_type_attribute)
		(eq u2 sys.id)))
	(eq t1 standard.obj_id_change_exemption_subj_type_attribute)))

;;;;;;;;;;;;;;;;;;;;;;;;;;
;
; Macros
;

(in standard
	(macro obj_change_exemption_subj_type ((type ARG1))
		(call obj_id_change_exemption_subj_type (ARG1))

		(tunableif enable_rbacsep
			(true
				(call
					rbacsep.obj_role_change_exemption_subj_type
						(ARG1)))))

	(macro obj_id_change_exemption_subj_type ((type ARG1))
		(typeattributeset obj_id_change_exemption_subj_type_attribute
			ARG1))

	(macro uncond_exemption_subj_type ((type ARG1))
		(typeattributeset uncond_exemption_subj_type_attribute ARG1))

	(macro sys_change_exemption_subj_type ((type ARG1))
		(call sys_id_change_exemption_subj_type (ARG1))
		(call sys_role_change_exemption_subj_type (ARG1)))

	(macro sys_id_change_exemption_subj_type ((type ARG1))
		(typeattributeset sys_id_change_exemption_subj_type_attribute
			ARG1))

	(macro sys_role_change_exemption_subj_type ((type ARG1))
		(typeattributeset sys_role_change_exemption_subj_type_attribute
			ARG1))

	(macro obj_sys_change_exemption_subj_type ((type ARG1))
		(call obj_sys_id_change_exemption_subj_type (ARG1))

		(tunableif enable_rbacsep
			(true
				(call
					rbacsep.obj_sys_role_change_exemption_subj_type
						(ARG1)))))

	(macro obj_sys_id_change_exemption_subj_type ((type ARG1))
		(typeattributeset
			obj_sys_id_change_exemption_subj_type_attribute ARG1))

	(macro change_exemption_subj_type ((type ARG1))
		(call id_change_exemption_subj_type (ARG1))
		(call role_change_exemption_subj_type (ARG1)))

	(macro id_change_exemption_subj_type ((type ARG1))
		(typeattributeset id_change_exemption_subj_type_attribute
			ARG1))

	(macro role_change_exemption_subj_type ((type ARG1))
		(typeattributeset role_change_exemption_subj_type_attribute
			ARG1))

	(macro user_exemption_target_subj_type ((type ARG1))
		(typeattributeset user_exemption_target_subj_type_attribute
			ARG1)))

;;;;;;;;;;;;;;;;;;;;;;;;;;
;
; Policy
;

(block standard
	(typeattribute obj_id_change_exemption_subj_type_attribute)

	(typeattribute id_change_exemption_subj_type_attribute)
	(typeattribute role_change_exemption_subj_type_attribute)

	(typeattribute obj_sys_id_change_exemption_subj_type_attribute)

	(typeattribute sys_id_change_exemption_subj_type_attribute)
	(typeattribute sys_role_change_exemption_subj_type_attribute)

	(typeattribute user_exemption_target_subj_type_attribute)

	(typeattribute uncond_exemption_subj_type_attribute))

(tunableif (and (not enable_mls) (not enable_mcs))
	(true
		(mls false)

		(sensitivity s0)
		(sensitivityorder (s0))

		(category c0)
		(categoryorder (c0))

		(sensitivitycategory s0 (c0))

		(level systemlow (s0))
		(level systemhigh (s0 (c0)))))
